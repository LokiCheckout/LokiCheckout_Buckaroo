<script>
    let buckarooHostedFieldsClient;

    document.addEventListener('alpine:init', () => {
        Alpine.data('LokiCheckoutBuckarooHostedFields', () => ({
            ...LokiCheckoutComponentType,
            jwtToken: '',
            allowedIssuers: [],
            async initHostedFields() {
                buckarooHostedFieldsClient = new BuckarooHostedFieldsSdk.HFClient(this.jwtToken);
                buckarooHostedFieldsClient.setLanguage('nl');
                buckarooHostedFieldsClient.setSupportedServices(this.allowedIssuers);

                let options = {
                    id: this.elementId + "-cc-number",
                    placeHolder: "John Doe",
                    labelSelector: "#cc-name-label",
                    baseStyling: {
                        width: "100",
                        background: "inherit",
                        placeholderColor:'grey'
                    },
                    validStyling: {},
                    invalidStyling: {},
                };

                await buckarooHostedFieldsClient.startSession(function (event) {
                    // @todo: See https://docs.buckaroo.io/docs/creditcards-hosted-fields#initialize-hosted-fields
                    buckarooHostedFieldsClient.handleValidation(
                        event,
                        this.elementId + '-cc-name-error',
                        this.elementId + '-cc-number-error',
                        this.elementId + '-cc-expiry-error',
                        this.elementId + '-cc-cvc-error'
                    );
                });

                buckarooHostedFieldsClient.mountCardHolderName("#" + this.elementId + "-cc-name-wrapper", {
                    id: "ccname",
                    placeHolder: "John Doe",
                    labelSelector: "#" + this.elementId + "-cc-name-label",
                    baseStyling: {}
                }).then(field => {
                    field.focus();
                    return field;
                });

                return;

                buckarooHostedFieldsClient.mountCardNumber('#' + this.elementId + "-cc-number-wrapper", options);
                //buckarooHostedFieldsClient.mountCardHolderName('#' + this.elementId + "-cc-name-wrapper", options);
                /*await buckarooHostedFieldsClient.mountCardHolderName('#' + this.elementId + "-cc-name-wrapper", options)
                    .then(function (cardHolderNameField) {
                        cardHolderNameField.focus();
                    });*/

            },
            async beforePostNextStep() {
                //buckarooHostedFieldsClient.startSession();
                await buckarooHostedFieldsClient.startSession(function (event) {
                    // @todo: See https://docs.buckaroo.io/docs/creditcards-hosted-fields#initialize-hosted-fields
                    buckarooHostedFieldsClient.handleValidation(
                        event,
                        this.elementId + '-cc-name-error',
                        this.elementId + '-cc-number-error',
                        this.elementId + '-cc-expiry-error',
                        this.elementId + '-cc-cvc-error'
                    );
                });




                //this.post({
                //});
            }
        }));
    });
</script>
